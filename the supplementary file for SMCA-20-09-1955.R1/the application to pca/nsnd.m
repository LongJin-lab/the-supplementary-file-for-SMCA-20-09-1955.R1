% The function implementes the computational flow of the proposed noise-suppressing 
% neural dynamics (12) in the manuscript and return parameters for mainfile.m.

function y=nsnd(t,u,gamma,alpha,m,n,p)
% mA depicts equality constraints of PCA (32) in the manuscript, and it
% could also be used as a function.
mA=[0 0]; 
% mC depicts inequality constraints of PCA (32) in the manuscript, and it
% could also be used as a function.
mC=[eye(2);-eye(2)];
% mW corresponds to the equation (7) in the manuscript, and it
% could also be used as a function.
mW=zeros(2,2);
% vb corresponds to the equality constraint of PCA (32) in the manuscript, and it
% could also be used as a function.
vb=0;
%vd corresponds to the inequality constraint of PCA (32) in the manuscript, and it
% could also be used as a function.
vd=[ones(2,1);ones(2,1)];

s=t;
delta=eps*ones(p,1);
x=u(1:n);
mu=u(n+m+1:n+m+p);
e=vd-mC*x;
D1=diag(e./sqrt(e.*e+mu.*mu+delta));
D2=diag(mu./sqrt(e.*e+mu.*mu+delta));
yye=u(n+m+p+1:2*(n+m+p));

x1=u(1);
x2=u(2);

%To reduce the computing time in ODE function, the derivative of different 
% parameters is calculated in file: dataset, and then could be used here.

% the time derivative of the objective function
g_cs =[ ((x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))*(x1 + conj(x1)))/(x1*conj(x1) + x2*conj(x2))^2 - ((28634363713799155632140197081925277*x1)/649037107316853453566312041152512 + (912592535921626750398710280157651*x2)/20282409603651670423947251286016 + (28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016)/(x1*conj(x1) + x2*conj(x2));
   ((x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))*(x2 + conj(x2)))/(x1*conj(x1) + x2*conj(x2))^2 - ((912592535921626750398710280157651*x1)/20282409603651670423947251286016 + (9315342639058740568825523906462425*x2)/162259276829213363391578010288128 + (912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128)/(x1*conj(x1) + x2*conj(x2))];
 
% the Hessian matrix  
dotf =[ (2*(x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016)))/(x1*conj(x1) + x2*conj(x2))^2 - 28634363713799155632140197081925277/(324518553658426726783156020576256*(x1*conj(x1) + x2*conj(x2))) + (2*(x1 + conj(x1))*((28634363713799155632140197081925277*x1)/649037107316853453566312041152512 + (912592535921626750398710280157651*x2)/20282409603651670423947251286016 + (28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))/(x1*conj(x1) + x2*conj(x2))^2 - (2*(x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))*(x1 + conj(x1))^2)/(x1*conj(x1) + x2*conj(x2))^3, ((x1 + conj(x1))*((912592535921626750398710280157651*x1)/20282409603651670423947251286016 + (9315342639058740568825523906462425*x2)/162259276829213363391578010288128 + (912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128))/(x1*conj(x1) + x2*conj(x2))^2 - 912592535921626750398710280157651/(10141204801825835211973625643008*(x1*conj(x1) + x2*conj(x2))) + ((x2 + conj(x2))*((28634363713799155632140197081925277*x1)/649037107316853453566312041152512 + (912592535921626750398710280157651*x2)/20282409603651670423947251286016 + (28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))/(x1*conj(x1) + x2*conj(x2))^2 - (2*(x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))*(x1 + conj(x1))*(x2 + conj(x2)))/(x1*conj(x1) + x2*conj(x2))^3;
((x1 + conj(x1))*((912592535921626750398710280157651*x1)/20282409603651670423947251286016 + (9315342639058740568825523906462425*x2)/162259276829213363391578010288128 + (912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128))/(x1*conj(x1) + x2*conj(x2))^2 - 912592535921626750398710280157651/(10141204801825835211973625643008*(x1*conj(x1) + x2*conj(x2))) + ((x2 + conj(x2))*((28634363713799155632140197081925277*x1)/649037107316853453566312041152512 + (912592535921626750398710280157651*x2)/20282409603651670423947251286016 + (28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))/(x1*conj(x1) + x2*conj(x2))^2 - (2*(x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))*(x1 + conj(x1))*(x2 + conj(x2)))/(x1*conj(x1) + x2*conj(x2))^3,     (2*(x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016)))/(x1*conj(x1) + x2*conj(x2))^2 - 9315342639058740568825523906462425/(81129638414606681695789005144064*(x1*conj(x1) + x2*conj(x2))) + (2*(x2 + conj(x2))*((912592535921626750398710280157651*x1)/20282409603651670423947251286016 + (9315342639058740568825523906462425*x2)/162259276829213363391578010288128 + (912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128))/(x1*conj(x1) + x2*conj(x2))^2 - (2*(x2*((912592535921626750398710280157651*conj(x1))/20282409603651670423947251286016 + (9315342639058740568825523906462425*conj(x2))/162259276829213363391578010288128) + x1*((28634363713799155632140197081925277*conj(x1))/649037107316853453566312041152512 + (912592535921626750398710280157651*conj(x2))/20282409603651670423947251286016))*(x2 + conj(x2))^2)/(x1*conj(x1) + x2*conj(x2))^3];
 

dotg=[ 0; 0];
dW=zeros(n,n); 
g1=(g_cs);
dotg=(dotg);
dotf=(dotf);
z3=zeros(p,1);
z4=zeros(p,p);
dC=zeros(p,n);
I=eye(p,p);
% the following parameters could be referred to equation (11) in the
% manuscript.
mM=[dotf mC';(D1-I)*mC I-D2];
mN=[dW dC';dC z4];
mH=[mW mC';-mC I];
g=[dotg;z3];
v=[g1;vd-sqrt(e.*e+mu.*mu+delta)];
m_M=inv(mM);
noise2=1*rand((n+m+p),1);

% the solution of the noise-suppressing neural dynamics (12) in the manuscript
dot_u=m_M*(-mN*u(1:n+m+p)-g-gamma*AFMlinear(mH*u(1:n+m+p)+v)-alpha*AFMbound((mH*u(1:n+m+p)+v)+gamma*AFMlinear(yye))+noise2);%n+m+2*pŒ¨œÚ¡ø
ye=mH*u(1:n+m+p)+v;

y=[dot_u;ye];


t


